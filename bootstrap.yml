---
- name: Bootstrap all (step 1/3)
  hosts: all
  gather_facts: true
  remote_user: root

  roles:
    - sudo
    - facts
    - kernel
    - modules
    - locale
    - aur-helper
    - bootloader
    - mounts
    - networking
    - users
    - cron
    - pacman
    - { role: packages, packages: ['git', 'openssh', 'inetutils'] }
    - { role: services, services: ['sshd'] }
    - { role: virtualbox-guest, when: ansible_virtualization_type == 'virtualbox' }

- name: Bootstrap laptops
  gather_facts: true
  hosts: laptop
  remote_user: root

  roles:
    - { role: networking, wireless: true }

- name: Bootstrap all (step 2/3)
  hosts: all
  gather_facts: true
  remote_user: root
  become_user: enrique
  become: true
  become_method: sudo

  roles:
    - ssh-client
    - ssh-keys

- name: Bootstrap all (step 3/3)
  hosts: all
  gather_facts: true
  remote_user: root

  roles:
    - root
    - sshd
