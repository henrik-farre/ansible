---
- hosts: all
  roles:
    - hostname
    - locale
    - timezone
    - ntp
    - system-mail
    - users
    - sshd
    - ssh-client
    - ssh-keys
    - dotfiles
    - vim

- hosts: archlinux
  roles:
    - modules
    - cron
    - hddtemp
    - sysctl
    - journald
    - firewall
    - makepkg
    - system-maintenance
    - global-aliases
    - misc-setup
    - xdg-dirs
    - docker
    - { role: backup-duplicity-docker, when: duplicity is defined }
    - php
    - fuse
    - { role: packages, packages: "{{ host_packages }}" }
    - { role: services, services: "{{ host_services }}" }
    - { role: packages-uninstalled, packages: "{{ host_uninstalled_packages }}" }

- hosts: desktop
  roles:
    - xorg
    - lightdm
    - { role: packages, packages: "{{ desktop_packages }}" }
    - fonts
    - cinnamon
    - conky
    - zim
    - samba-client
    - node
    - firefox
    - xcape
    - systemd-user-units
    - terminal
    - aur-helper
    - cups
    - devilspie
    - { role: aur-packages, packages: "{{ aur_packages }}" }
  tasks:
    - name: Ensure files does not exist
      file:
        path: "{{ item }}"
        state: absent
      with_items:
        - "{{ansible_user_dir}}/.config/xfce"
        - "{{ansible_user_dir}}/.xfce4-session.verbose-log"
        - "{{ansible_user_dir}}/.config/autostart/xfce4-settings-helper-autostart.desktop"
        - "{{ansible_user_dir}}/.config/autostart/xfce4-tips-autostart.desktop"
        - "{{ansible_user_dir}}/.config/autostart/xfce4-power-manager.desktop"
        - "{{ansible_user_dir}}/.yaourtrc"

- hosts: htpc
  roles:
    - kodi-shutdown-check
    - unifi-controller-backup
    - getmail

- hosts: laptop
  roles:
    - powersave

- hosts: macbook
  roles:
    - { role: aur-packages, packages: ['mbpfan-git'] }
    - { role: services, services: ['mbpfan'] }

- hosts: raspberrypi
  roles:
    - arpwatch
    - docker

  tasks:
    - name: Disable swap
      become: yes
      command: "{{ item }}"
      args:
        removes: /sbin/dphys-swapfile
      loop:
        - "swapoff -a"
        - "dphys-swapfile swapoff"
        - "dphys-swapfile uninstall"

    - name: Disable stuff
      become: yes
      systemd:
        name: "{{ item }}"
        state: stopped
        enabled: no
      loop:
        - alsa-restore.service
        - avahi-daemon
        - bluetooth
        - dphys-swapfile.service
        - rsyslog.service
        - syslog.socket
        - triggerhappy
        - triggerhappy.socket
        - wpa_supplicant
      failed_when: False

    - name: Remove stuff
      become: yes
      apt:
        name: "{{ packages }}"
        state: absent
        purge: yes
        autoclean: yes
        autoremove: yes
      vars:
        packages:
          - rsyslog
          - dphys-swapfile
          - triggerhappy
          - bluetooth
          - wpasupplicant
          - wireless-tools
          - wireless-regdb
          - v4l-utils
          - pi-bluetooth

- hosts: unifi-controller
  roles:
    - unifi-controller
