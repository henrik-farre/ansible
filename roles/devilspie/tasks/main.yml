---
# - name: Ensure systemd unit is disabled
  # systemd:
    # name: devilspie2.service
    # enabled: no
    # daemon_reload: no
    # user: yes
  # tags:
    # - devilspie2

- name: Ensure devilspie2 dependencies are installed
  become: yes
  pacman:
    state: latest
    name: lua-socket

- name: Ensure systemd unit file is removed
  file:
    path: "{{ ansible_user_dir }}/.config/systemd/user/devilspie2.service"
    state: absent
  tags:
    - devilspie

- name: Ensure autostart directory exists
  file:
    path: "{{ ansible_user_dir }}/.config/autostart"
    state: directory

- name: Check if devilspie2 is installed
  stat:
    path: /usr/bin/devilspie2
  register: devilspie2_bin

- name: Ensure devilspie2 is compiled and installed
  include_role:
    name: aur-packages
  vars:
    packages:
      - devilspie2
    gpg_keys: 194B631AB2DA2888
  when: not devilspie2_bin.stat.exists

- name: Ensure devilspie is auto started
  copy:
    dest: "{{ ansible_user_dir }}/.config/autostart/devilspie2.desktop"
    content: |
      [Desktop Entry]
      Name=Devilspie2
      Exec=/usr/bin/devilspie2
      Type=Application
