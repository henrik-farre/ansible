---
- name: Ensure power saving is configured
  become: yes
  tags:
    - powersave
  block:
    - name: Ensure powersave profile daemon is installed
      pacman:
        name: power-profiles-daemon
        state: latest

    - name: Ensure powersave profile daemon is enabled and started
      ansible.builtin.systemd:
        name: power-profiles-daemon
        state: started
        enabled: yes

    - name: Ensure powersaving related packages are installed
      pacman:
        state: latest
        name: "{{ packages }}"
      vars:
        packages:
          - 'powertop'
          - 'ethtool'
          - 'x86_energy_perf_policy'
