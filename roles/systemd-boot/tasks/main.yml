---
- name: Ensure directories for bootloader exist
  become: yes
  file:
    path: "{{ item }}"
    state: directory
    owner: root
    mode: 0700
  with_items:
    - "/boot/loader"
    - "/boot/loader/entries"
  tags:
    - bootloader
    - systemd-boot

# Currently only used on workstation, should be expanded to handle
# multiple systems
- name: Ensure loader and entries for systemd-boot exist
  become: yes
  copy:
    src: "boot/loader/{{ item }}"
    dest: "/boot/loader/{{ item }}"
    owner: root
    mode: 0600
  with_items:
    - "entries/arch.conf"
  tags:
    - bootloader
    - systemd-boot

- name: Install systemd-boot
  become: yes
  command: bootctl --path=/boot install
  args:
    creates: /boot/EFI/systemd/systemd-bootx64.efi
  tags:
    - bootloader
    - systemd-boot

- name: Install systemd-boot-pacman-hook from AUR
  become: yes
  become_user: aur_builder
  aur:
    name: systemd-boot-pacman-hook
