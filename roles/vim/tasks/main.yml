---
- name: Clone neovim/vim files
  git:
    repo: git@github.com:henrik-farre/vimrc.git
    dest: "{{ ansible_user_dir }}/.config/nvim"
  tags:
    - vim

- name: Create backups and swaps dirs
  file:
    path: "{{ ansible_user_dir }}/.config/nvim/{{ item }}"
    owner: "{{ ansible_user_id }}"
    state: directory
    mode: 0700
  with_items:
    - backups
    - swaps
  tags:
    - vim

- name: Ensure .local/share/applications exists
  file:
    path: "{{ ansible_user_dir }}/.local/share/applications"
    owner: "{{ ansible_user_id }}"
    state: directory
    mode: 0700
  tags:
    - vim

- name: Install .desktop file
  copy:
    src: neovim.desktop
    dest: "{{ ansible_user_dir }}/.local/share/applications/neovim.desktop"
    owner: "{{ ansible_user_id }}"
  tags:
    - vim

# https://github.com/mhinz/neovim-remote
- name: Install neovim-remote
  pip:
    name: neovim-remote
    extra_args: --user
    executable: pip3
  tags:
    - vim

# Hangs
# - name: Install plugins
#   command: nvim +PlugInstall +qall
#   tags:
#     - vim

- name: Check if vim is installed
  stat:
    path: /usr/bin/vim
  register: vim_installation
  tags:
    - vim

- name: Create .vimrc symlink for vim
  file:
    src: "{{ ansible_user_dir }}/.config/nvim/init.vim"
    dest: "{{ ansible_user_dir }}/.vimrc"
    state: link
  tags:
    - vim
  when: vim_installation.stat.exists == True

- name: Create .vim symlink for vim
  file:
    src: "{{ ansible_user_dir }}/.config/nvim"
    dest: "{{ ansible_user_dir }}/.vim"
    state: link
  tags:
    - vim
  when: vim_installation.stat.exists == True
