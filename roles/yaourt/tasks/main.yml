---
- name: Build yaourt, clone package-query
  git:
    repo: https://aur.archlinux.org/package-query.git
    dest: "{{ ansible_user_dir }}/package-queue"
    accept_hostkey: yes
  delegate_to: localhost
  tags:
    - yaourt

- name: Build yaourt, makepkg package-query
  command: makepkg -si
  args:
    chdir: "{{ ansible_user_dir }}/package-queue"
    creates: /usr/bin/package-query
  delegate_to: localhost
  register: aur_makepkg_result
  tags:
    - yaourt

- name: Build yaourt, install package-query
  become: yes
  command: pacman -U "{{ item }}" --noconfirm --noprogressbar
  args:
    creates: /usr/bin/package-query
  with_fileglob:
    - "{{ ansible_user_dir }}/package-queue/package-query-*-x86_64.pkg.tar.xz"
  delegate_to: localhost
  when:
    - aur_makepkg_result|succeeded
  tags:
    - yaourt

- name: Build yaourt, clone yaourt
  git:
    repo: https://aur.archlinux.org/yaourt.git
    dest: "{{ ansible_user_dir }}/yaourt"
    accept_hostkey: yes
  delegate_to: localhost
  tags:
    - yaourt

- name: Build yaourt
  command: makepkg -si
  args:
    chdir: "{{ ansible_user_dir }}/yaourt"
    creates: /usr/bin/yaourt
  delegate_to: localhost
  register: aur_makepkg_result
  tags:
    - yaourt

- name: Build yaourt, install yaourt
  become: yes
  command: pacman -U "{{ item }}" --noconfirm --noprogressbar
  args:
    creates: /usr/bin/yaourt
  with_fileglob:
    - "{{ ansible_user_dir }}/yaourt/yaourt-*-any.pkg.tar.xz"
  delegate_to: localhost
  when:
    - aur_makepkg_result|succeeded
  tags:
    - yaourt
