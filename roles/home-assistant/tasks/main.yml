---
- name: Ensure home assistant is installed and configured
  become: true
  tags:
    - home-assistant
  block:
    - name: Ensure needed directories exist
      ansible.builtin.file:
        path: "/srv/home-assistant/{{ item }}"
        state: directory
        mode: 0775
        owner: root
        group: docker
      loop:
        - data
        - deploy

    - name: Ensure docker-compose.yml exists for home assistant
      ansible.builtin.template:
        src: docker-compose.yml.j2
        dest: /srv/home-assistant/deploy/docker-compose.yml
        mode: 0664
        owner: root
        group: docker

    - name: Deploy Docker Compose stack
      community.docker.docker_compose:
        project_src: /srv/home-assistant/deploy
      register: output

    - name: Debug
      ansible.builtin.debug:
        var: output

# hacs install
# run inside data/config folder
# https://raw.githubusercontent.com/hacs/get/main/get
