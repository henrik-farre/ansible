---
- name: Ensure Gnome is configured
  tags:
    - gnome
  block:
    - name: Ensure packages are installed
      become: yes
      community.general.pacman:
        name: "{{ packages }}"
        state: latest
      vars:
        packages:
          - gdm
          - gnome-shell
          - gnome-menus
          - gnome-settings-daemon
          - gnome-session
          - gnome-control-center
          - gnome-icon-theme-extras
          - gnome-tweaks
          - gnome-shell-extensions
          - gnome-shell-extension-gtile
          - gnome-shell-extension-appindicator
          - gnome-calculator
          - gnome-keyring
          - xdg-desktop-portal-gnome
          - nautilus

    - name: Ensure integration to extensions.gnome.org is installed
      become_user: aur_builder
      aur:
        name: chrome-gnome-shell-git

    - name: Ensure gnome first startup script is installed
      ansible.builtin.copy:
        dest: "{{ ansible_user_dir }}/.local/bin/gnome-first-start.sh"
        src: "local/bin/gnome-first-start.sh"
        mode: 0750
      notify: Remove gnome first start done file

    - name: Ensure desktop file for first start is installed
      ansible.builtin.template:
        dest: "{{ ansible_user_dir }}/.config/autostart/gnome-first-start.desktop"
        src: gnome-first-start.desktop.j2
        mode: 0640
