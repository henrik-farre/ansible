---
- name: Clone dot files
  git:
    repo: git@github.com:henrik-farre/dotfiles.git
    dest: "{{ ansible_user_dir }}/.dotfiles"
  tags:
    - dotfiles

- name: Ensure directories exist
  file:
    path: "{{ ansible_user_dir }}/{{ item }}"
    owner: "{{ ansible_user_id }}"
    state: directory
    mode: 0700
  with_items:
    - ".config"
    - ".config/fontconfig"
  tags:
    - dotfiles

- name: Check if skel files exists
  stat:
    path: "{{ ansible_user_dir }}/.bashrc"
  register: bash_skelfile
  tags:
    - dotfiles

- name: Remove existing skel files
  file:
    path: "{{ ansible_user_dir }}/{{ item }}"
    state: absent
  with_items:
    - ".bashrc"
    - ".bash_profile"
  when: bash_skelfile.stat.islnk is defined and bash_skelfile.stat.islnk == False
  tags:
    - dotfiles

- name: Symlink files
  file:
    src: "{{ ansible_user_dir }}/.dotfiles/{{ item }}"
    dest: "{{ ansible_user_dir }}/{{ item }}"
    owner: "{{ ansible_user_id }}"
    state: link
  with_items:
    - ".config/termite"
    - ".config/htop"
    - ".zshrc"
    - ".bash_profile"
    - ".bashrc"
    - ".config/shells"
    - ".tmux.conf"
    - ".tmuxinator"
    - ".screenrc"
    - ".inputrc"
    - ".ackrc"
    - ".ctags"
    - ".jshintrc"
    - ".gemrc"
    - ".npmrc"
    - ".pearrc"
    - ".yaourtrc"
    - ".Xmodmap"
    - ".Xresources"
    - ".config/fontconfig/fonts.conf"
    - ".gitconfig"
    - ".gitignore"
    - ".git_template"
    - ".config/weechat"
    - "bin"
  tags:
    - dotfiles
